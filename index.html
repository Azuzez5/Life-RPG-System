<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Life RPG System - Auto Mode</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    body { font-family: Arial, sans-serif; background:#0f172a; color:#e5e7eb; margin:0; padding:15px; }
    .container { display:grid; grid-template-columns:1fr; gap:15px; }
    @media (min-width:900px){ .container{grid-template-columns:1fr 1fr;} }
    .card { background:#111827; border-radius:12px; padding:15px; box-shadow:0 0 12px rgba(0,0,0,.4); }
    .bar { background:#1f2933; border-radius:8px; overflow:hidden; height:16px; margin:6px 0 10px; }
    .bar-inner { height:100%; background:linear-gradient(90deg,#22c55e,#4ade80); width:0%; }
    .boss-bar-inner { background:linear-gradient(90deg,#ef4444,#f87171); }
    button { background:#2563eb; border:none; color:white; padding:10px; border-radius:8px; width:100%; margin-top:6px; cursor:pointer; }
    button:hover { background:#1d4ed8; }
    .log { max-height:200px; overflow-y:auto; font-size:13px; background:#020617; padding:8px; border-radius:6px; }
    .quest { background:#020617; padding:10px; border-radius:8px; margin-top:6px; }
  </style>
</head>
<body>

<h1>ğŸ® Life RPG System </h1>
<p>LÃ m chá»§ cuá»™c sá»‘ng cá»§a báº¡n trong game</p>

<div class="container">
    <!-- SHOP -->
  <div class="card">
  <h2>ğŸ›’ Shop Power-Up</h2>

  <button onclick="buyPowerup('doubleExp')">
    âš¡ Double EXP (2 quest) â€” 50 Gold
  </button>

  <button onclick="buyPowerup('strongAttack')">
    âš”ï¸ Strong Attack (+20 dmg) â€” 75 Gold
  </button>

  <button onclick="buyPowerup('bonusGold')">
    ğŸ’° Bonus Gold (+50% gold 3 láº§n) â€” 60 Gold
  </button>

  <div style="margin-top:8px;font-size:13px;">
    Buff Ä‘ang hoáº¡t Ä‘á»™ng:
    <div id="buffList"></div>
  </div>
</div>
  <!-- PLAYER -->
  <div class="card">
    <h2>ğŸ‘¤ NhÃ¢n váº­t: <span id="playerNameLabel"></span></h2>
    <div>ğŸ’° Gold: <b id="goldLabel">0</b></div>
    <div>ğŸ”¥ Streak: <b id="streakLabel">0</b> ngÃ y</div>
    <div style="margin-top:8px;">
  TÃªn nhÃ¢n váº­t:
  <input id="playerNameInput" placeholder="Nháº­p tÃªn nhÃ¢n váº­t">
  <button onclick="changeName()">âœï¸ Äá»•i tÃªn</button>
</div>

<div style="margin-top:6px;">
  Danh hiá»‡u: <b id="playerTitle">None</b>
</div>
    <div>Level: <b id="level">1</b></div>
    <div>EXP: <span id="exp">0</span> / <span id="nextExp">100</span></div>
    <div class="bar"><div id="expBar" class="bar-inner"></div></div>

    <h3>ğŸ“Š Ká»¹ nÄƒng</h3>
    <div>ğŸ“š Há»c táº­p: <b id="skillStudy">0</b></div>
    <div>ğŸ’ª Sá»©c khá»e: <b id="skillHealth">0</b></div>
    <div>ğŸ§  Ká»· luáº­t: <b id="skillDiscipline">0</b></div>
    <div>ğŸ’¬ Giao tiáº¿p: <b id="skillSocial">0</b></div>
  </div>

  <!-- DAILY QUEST -->
  <div class="card">
    <h2>ğŸ“œ Daily Quest </h2>
    <div id="questBox" class="quest"></div>
    <button onclick="completeQuest()">âœ… HoÃ n thÃ nh Quest</button>
    <button onclick="rerollQuest()">ğŸ” Äá»•i Quest (Random)</button>
    <div class="card">
  <h2>ğŸ¤– AI Coach</h2>
  <div id="aiAdvice">AI Ä‘ang theo dÃµi báº¡n...</div>
</div>
  </div>

  <!-- BOSS -->
  <div class="card">
    <h2>ğŸ‘¹ Current Boss</h2>
    <div><b id="bossTitle"></b></div>
    <div>HP: <span id="bossHP"></span> / <span id="bossMaxHP"></span></div>
    <div class="bar"><div id="bossBar" class="bar-inner boss-bar-inner"></div></div>
    <button onclick="attackBoss()">âš”ï¸ ÄÃ¡nh Boss (-20 HP)</button>
    <button onclick="spawnBoss()">ğŸ§¬ Triá»‡u há»“i Boss khÃ¡c</button>
  </div>

  <!-- LOG -->
  <div class="card">
    <h2>ğŸ“– Nháº­t kÃ½</h2>
    <div id="log" class="log"></div>
    <button onclick="resetGame()" style="background:#dc2626;">ğŸ—‘ Reset Game</button>
  </div>

</div>

<script>
// ================= DATA =================
let data = {
  playerName: "Hero",
  title: "",
  nameHistory: [],
  gold: 0,               // ğŸ’° TIá»€N
  activeBuffs: [],      // âš¡ POWERUP ÄANG HOáº T Äá»˜NG
  streak: {
  current: 0,
  lastDate: ""
},
  ai: {
  questsDone: 0,
  bossesKilled: 0,
  rerolls: 0,
  advice: "AI Ä‘ang theo dÃµi báº¡n..."
},

  level:1, exp:0, nextExp:100,
  skills:{study:0,health:0,discipline:0,social:0},
  boss:null,
  quest:null,
  log:[]
  
};
// ================= 50 BOSSES =================
const BOSSES = [
  "Thi Há»c Ká»³","Deadline Dá»± Ãn","LÆ°á»i Biáº¿ng","TikTok Demon","YouTube Abyss",
  "Máº¥t Táº­p Trung","Thiáº¿u Ngá»§","CÃ¡m Dá»— Game","Overthinking","Stress",
  "Procrastination King","ToÃ¡n Cao Cáº¥p","Váº­t LÃ½ KhÃ³","IELTS Speaking",
  "BÃ i Táº­p Chá»“ng Cháº¥t","Ãp Lá»±c Gia ÄÃ¬nh","Máº¥t Äá»™ng Lá»±c","Deadline 11:59PM",
  "QuÃªn BÃ i","Thi TrÆ°á»£t","Nghiá»‡n Äiá»‡n Thoáº¡i","Thi Giá»¯a Ká»³","BÃ i Thuyáº¿t TrÃ¬nh",
  "Ãp Lá»±c Äiá»ƒm Sá»‘","Thi Thá»­","Máº¥t Ká»· Luáº­t","Buá»“n Ngá»§","CÃ¡m Dá»— Netflix",
  "Task QuÃ¡ Táº£i","ChÃ¡n Há»c","LÆ°á»i Táº­p Thá»ƒ Dá»¥c","Thiáº¿u Tá»± Tin","BÃ i Táº­p NhÃ³m",
  "Overload ThÃ´ng Tin","Thi Há»c Sinh Giá»i","Ãp Lá»±c Ká»³ Vá»ng","Deadline SÃ¡t NÃºi",
  "Thi Thá»±c HÃ nh","Máº¥t Táº­p Trung SÃ¡ng","Má»‡t Má»i","Thi Online",
  "Thi Thá»­ Láº§n 2","BÃ i Luáº­n DÃ i","Thi NÃ³i","Thi Viáº¿t","Thi Nghe",
  "Thi Äá»c","Ãp Lá»±c ThÃ nh TÃ­ch","Thi Cuá»‘i Ká»³"
];
const QUEST_TYPE_WEIGHTS = {
  study: 6,
  discipline: 3,
  health: 2,
  social: 1
};
// ================= 200+ QUEST GENERATOR =================
const QUEST_TEMPLATES = [
  {t:"study", text:"Há»c {subject} {min} phÃºt"},
  {t:"study", text:"LÃ m {num} bÃ i táº­p {subject}"},
  {t:"study", text:"Ã”n láº¡i {subject} trong {min} phÃºt"},
  {t:"health", text:"Táº­p thá»ƒ dá»¥c {min} phÃºt"},
  {t:"health", text:"Äi bá»™ {num} phÃºt"},
  {t:"health", text:"HÃ­t thá»Ÿ sÃ¢u {num} láº§n"},
  {t:"discipline", text:"Dá»n bÃ n há»c trong {min} phÃºt"},
  {t:"discipline", text:"KhÃ´ng dÃ¹ng máº¡ng xÃ£ há»™i {min} phÃºt"},
  {t:"discipline", text:"HoÃ n thÃ nh viá»‡c khÃ³ nháº¥t hÃ´m nay"},
  {t:"social", text:"NÃ³i chuyá»‡n tÃ­ch cá»±c vá»›i 1 ngÆ°á»i"},
  {t:"social", text:"Gá»­i tin nháº¯n Ä‘á»™ng viÃªn ai Ä‘Ã³"},
  {t:"social", text:"Chá»§ Ä‘á»™ng há»i bÃ i / giÃºp Ä‘á»¡ ngÆ°á»i khÃ¡c"}
];

const SUBJECTS = ["ToÃ¡n","LÃ½","HÃ³a","Anh","VÄƒn","Sinh","IELTS","Tin há»c","Sá»­","Äá»‹a"];

// ================= CORE =================
function save(){ localStorage.setItem("lifeRPG_AUTO", JSON.stringify(data)); }
function load(){
  const s = localStorage.getItem("lifeRPG_AUTO");
  if(s) data = JSON.parse(s);
  if(!data.ai){
  data.ai = {
    questsDone: 0,
    bossesKilled: 0,
    rerolls: 0,
    advice: "AI Ä‘ang theo dÃµi báº¡n..."
  };
}
if(!data.activeBuffs) data.activeBuffs = [];
if(!data.gold) data.gold = 0;
  if(!data.boss) spawnBoss();
  if(!data.quest) spawnQuest();
  render();
if(!data.streak){
  data.streak = {
    current: 0,
    lastDate: ""
  };
}
}

function addLog(t){
  const time = new Date().toLocaleTimeString();
  data.log.unshift(`[${time}] ${t}`);
  if(data.log.length>80) data.log.pop();
  save(); render();
}

function gainExp(x){
  data.exp += x;
  while(data.exp >= data.nextExp){
    data.exp -= data.nextExp;
    data.level++;
    data.nextExp = Math.floor(data.nextExp*1.25);
    addLog(`ğŸ†™ LÃŠN LEVEL ${data.level}`);
  }
}

// ================= BOSS =================
function spawnBoss(){
  const name = BOSSES[Math.floor(Math.random()*BOSSES.length)];

  // Rarity
  const r = Math.random();
  let rarity = "Normal";
  let rarityMult = 1;
  if(r > 0.9){ rarity = "Legendary"; rarityMult = 2; }
  else if(r > 0.7){ rarity = "Elite"; rarityMult = 1.5; }

  // Skill
  const skills = ["shield","rage","regen","dodge"];
  const skill = skills[Math.floor(Math.random()*skills.length)];

  const baseHp = Math.floor((100 + Math.random()*150 + data.level*10) * rarityMult);

  data.boss = { 
    name, 
    hp: baseHp, 
    maxHp: baseHp,
    rarity,
    skill,
    enraged: false
  };

  addLog(`ğŸ‘¹ Boss má»›i: [${rarity}] ${name} (${baseHp} HP, ${skill})`);
  save(); 
  render();
}

function attackBoss(){
  if(!data.boss) return;

  let dmg = 20;

  // Buff Strong Attack
  const atkBuff = data.activeBuffs.find(b => b.type==="strongAttack");
  if(atkBuff){
    dmg += 20;
    atkBuff.uses--;
    addLog("âš”ï¸ Strong Attack kÃ­ch hoáº¡t!");
  }

  // Dodge
  if(data.boss.skill === "dodge" && Math.random() < 0.25){
    addLog("ğŸ’¨ Boss nÃ© Ä‘Ã²n!");
    save(); render();
    return;
  }

  // Shield
  if(data.boss.skill === "shield"){
    dmg = Math.floor(dmg * 0.5);
    addLog("ğŸ›¡ Boss cÃ³ Shield! Giáº£m sÃ¡t thÆ°Æ¡ng.");
  }

  // Rage bonus damage
  if(data.boss.skill === "rage"){
    const missing = 1 - data.boss.hp / data.boss.maxHp;
    dmg += Math.floor(missing * 20);
  }

  data.boss.hp -= dmg;
  gainExp(10);
  addLog(`âš”ï¸ GÃ¢y ${dmg} dmg lÃªn ${data.boss.name}`);

  // Regen
  if(data.boss.skill === "regen"){
    const heal = 5 + Math.floor(Math.random()*6);
    data.boss.hp = Math.min(data.boss.maxHp, data.boss.hp + heal);
    addLog(`ğŸ©¸ Boss há»“i ${heal} HP`);
  }

  // Enrage
  if(data.boss.hp / data.boss.maxHp < 0.3 && !data.boss.enraged){
    data.boss.enraged = true;
    addLog("ğŸ˜¡ BOSS ENRAGED!");
  }

  // Boss cháº¿t
  if(data.boss.hp <= 0){
    addLog(`ğŸ† Háº  Gá»¤C BOSS: ${data.boss.name}`);
    data.ai.bossesKilled++;

    const bossGold = Math.floor((30 + Math.random()*30) * 
      (data.boss.rarity === "Legendary" ? 2 :
       data.boss.rarity === "Elite" ? 1.5 : 1));

    data.gold += bossGold;
    addLog(`ğŸ’° Loot tá»« boss: +${bossGold} Gold`);

    data.boss = null;
    save();
    spawnBoss();
    return;
  }

  // Counter
  if(Math.random() < 0.2){
    const penalty = 5 + Math.floor(Math.random()*6);
    data.exp = Math.max(0, data.exp - penalty);
    addLog(`ğŸ’¥ Boss pháº£n cÃ´ng! Máº¥t ${penalty} EXP`);
  }

  save();
  render();
  updateAICoach();
}

// ================= QUEST =================
function weightedRandomType(){
  const pool = [];
  for(const type in QUEST_TYPE_WEIGHTS){
    for(let i=0;i<QUEST_TYPE_WEIGHTS[type];i++){
      pool.push(type);
    }
  }
  return pool[Math.floor(Math.random()*pool.length)];
}

function spawnQuest(){
  const chosenType = weightedRandomType();

  const filtered = QUEST_TEMPLATES.filter(q => q.t === chosenType);
  const tpl = filtered[Math.floor(Math.random()*filtered.length)];

  let text = tpl.text
    .replace("{subject}", SUBJECTS[Math.floor(Math.random()*SUBJECTS.length)])
    .replace("{min}", 10 + Math.floor(Math.random()*50))
    .replace("{num}", 3 + Math.floor(Math.random()*10));

  const exp = 15 + Math.floor(Math.random()*35); // study thÆ°á»ng EXP cao hÆ¡n

  data.quest = { text, type:tpl.t, exp };
  save(); render();
}

function completeQuest(){
  if(!data.quest) return;
  const streakResult = updateStreak();
  const q = data.quest;
  data.skills[q.type]++;
  data.ai.questsDone++;
  let finalExp = q.exp;
  let finalGold = Math.floor(q.exp / 2);

  const expBuff = data.activeBuffs.find(b => b.type==="doubleExp");
  if(expBuff){
    finalExp *= 2;
    expBuff.uses--;
    addLog("âš¡ Double EXP kÃ­ch hoáº¡t!");
  }

  const goldBuff = data.activeBuffs.find(b => b.type==="bonusGold");
  if(goldBuff){
    finalGold = Math.floor(finalGold * 1.5);
    goldBuff.uses--;
    addLog("ğŸ’° Bonus Gold kÃ­ch hoáº¡t!");
  }

  data.gold += finalGold;
  gainExp(finalExp);
if(streakResult){
  addLog(`ğŸ”¥ Streak: ${streakResult.streak} ngÃ y liÃªn tiáº¿p!`);
  addLog(`ğŸ ThÆ°á»Ÿng streak: +${streakResult.bonusExp} EXP, +${streakResult.bonusGold} Gold`);
}
  addLog(`ğŸ’° Nháº­n ${finalGold} Gold`);
  addLog(`âœ… Quest: ${q.text} (+${finalExp} EXP)`);

  data.quest = null;
  spawnQuest();
  save(); render();
  updateAICoach();
}

function rerollQuest(){
  spawnQuest();
  addLog("ğŸ” Äá»•i quest má»›i");
  data.ai.rerolls++;
  updateAICoach();
}

// ================= UI =================
function resetGame(){
  if(confirm("Reset toÃ n bá»™ dá»¯ liá»‡u?")){
    localStorage.removeItem("lifeRPG_AUTO");
    location.reload();
  }
}

function render(){
  goldLabel.textContent = data.gold;
  playerNameLabel.textContent = data.playerName;
  playerNameInput.value = data.playerName;
  playerTitle.textContent = data.title || "None";
  level.textContent = data.level;
  exp.textContent = data.exp;
  nextExp.textContent = data.nextExp;
  expBar.style.width = (data.exp/data.nextExp*100)+"%";

  skillStudy.textContent = data.skills.study;
  skillHealth.textContent = data.skills.health;
  skillDiscipline.textContent = data.skills.discipline;
  skillSocial.textContent = data.skills.social;

  if(data.quest){
    questBox.innerHTML = `
      <b>${data.quest.text}</b><br>
      Loáº¡i: ${data.quest.type} | EXP: ${data.quest.exp}
    `;
  }

  if(data.boss){
    bossTitle.textContent = data.boss.name;
    bossHP.textContent = Math.max(0,data.boss.hp);
    bossMaxHP.textContent = data.boss.maxHp;
    bossBar.style.width = (data.boss.hp/data.boss.maxHp*100)+"%";
  }

  log.innerHTML = data.log.map(l=>`<div>${l}</div>`).join("");
  data.activeBuffs = data.activeBuffs.filter(b => b.uses > 0);

if(buffList){
  buffList.innerHTML = data.activeBuffs.length
    ? data.activeBuffs.map(b=>`${b.type} (${b.uses})`).join("<br>")
    : "KhÃ´ng cÃ³";
}
if(aiAdvice){
  aiAdvice.textContent = data.ai.advice;
}
if(streakLabel){
  streakLabel.textContent = data.streak.current;
}
}
load();
function changeName(){
  const newName = playerNameInput.value.trim();
  if(!newName) return alert("Nháº­p tÃªn nhÃ¢n váº­t!");

  const oldName = data.playerName;
  data.playerName = newName;

  data.nameHistory.push({
    time: new Date().toLocaleString(),
    from: oldName,
    to: newName
  });

  addLog(`ğŸ§¬ Äá»•i tÃªn: ${oldName} â†’ ${newName}`);
  save();
  render();
}
const POWERUPS = {
  doubleExp: { cost:50, uses:2, name:"Double EXP" },
  strongAttack: { cost:75, uses:3, name:"Strong Attack" },
  bonusGold: { cost:60, uses:3, name:"Bonus Gold" }
};

function buyPowerup(type){
  const p = POWERUPS[type];
  if(data.gold < p.cost){
    return alert("KhÃ´ng Ä‘á»§ Gold!");
  }

  data.gold -= p.cost;
  data.activeBuffs.push({
    type,
    uses: p.uses
  });

  addLog(`ğŸ›’ Mua power-up: ${p.name}`);
  save(); render();
}
function updateAICoach(){
  const ai = data.ai;

  if(ai.rerolls > ai.questsDone){
    ai.advice = "ğŸ“› Báº¡n Ä‘ang Ä‘á»•i quest quÃ¡ nhiá»u. HÃ£y hoÃ n thÃ nh Ã­t nháº¥t 1 quest.";
  }
  else if(ai.questsDone >= 3){
    ai.advice = "ğŸ”¥ Tá»‘t láº¯m! Báº¡n Ä‘ang lÃ m ráº¥t tá»‘t hÃ´m nay.";
  }
  else{
    ai.advice = "ğŸ™‚ Cá»‘ gáº¯ng hoÃ n thÃ nh vÃ i quest Ä‘á»ƒ táº¡o Ä‘Ã .";
  }

  save();
}
function updateStreak(){
  const today = new Date().toDateString();
  const last = data.streak.lastDate;

  if(last === today){
    return;
  }

  if(!last){
    data.streak.current = 1;
  } 
  else {
    const lastDate = new Date(last);
    const diffDays = Math.floor((new Date() - lastDate) / (1000*60*60*24));

    if(diffDays === 1){
      data.streak.current++;
    } else {
      data.streak.current = 1;
    }
  }

  data.streak.lastDate = today;

  // Chá»‰ cáº­p nháº­t data, KHÃ”NG log, KHÃ”NG render á»Ÿ Ä‘Ã¢y
  const bonusExp = data.streak.current * 2;
  const bonusGold = data.streak.current;

  data.exp += bonusExp;
  data.gold += bonusGold;

  // Tráº£ vá» info Ä‘á»ƒ completeQuest log sau
  return {
    streak: data.streak.current,
    bonusExp,
    bonusGold
  };
}
</script>
</body>
</html>